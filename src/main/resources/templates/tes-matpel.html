<!DOCTYPE html>

<html xmlns:th="http://www.thymeLeaf.org">


<head>
    <object th:include = "fragments/fragment :: head"></object>
    <title>Tes Mata Pelajaran</title>
    <link href="bootstrap.min.css" rel="stylesheet"/>
<!--    <script th:src="@{/js/hris-bta-pagination-js.js}"></script>-->
    <script
            src="https://code.jquery.com/jquery-3.5.1.js"
            integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
            crossorigin="anonymous"></script>

</head>


<body id="page-top">

<!-- Page Wrapper -->
<div id="wrapper">

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

        <!-- Main Content -->
        <div id="content">

            <!-- Topbar -->
            <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow" style="height: 3rem;">
                <!-- Topbar Navbar -->
                <a class="btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter">< Kembali</a>

                <ul class="navbar-nav ml-auto">
                        <!-- Timer -->
                    <div class="text-center" id="status"></div>
                </ul>
            </nav>

            <!-- Begin Page Content -->
            <div class="container-fluid">

                <!-- Page Heading -->
                <h1 class="h3 mb-2 text-danger card-header-text" th:text="'TES 1 - ' + ${hasilTes.submittedPaketSoal.nama}"></h1>
                <h3 class="h5 mb-2 text-danger card-header-text" th:text="'(Jumlah soal: ' + ${jumlahSoal} + ')'"></h3><br>

                <!-- Soal -->
                <div id="loop">
                    <form th:object="${hasilTes}" method="POST" th:action="@{/calonpengajar/tes-matapelajaran}" id="tes">
                        <tr th:each="soal, iterationStatus : ${hasilTes.submittedPaketSoal.listSoal}">
                            <div class="card shadow mb-4">
                                <div class="card-body">
                                    <b><p th:text="${iterationStatus.count} + '. ' + ${soal.pertanyaan}"></p></b>
                                        <ul>
                                            <li class="no-bullets" th:action="@{#}" th:each="jawaban, iterStat : ${soal.listJawaban}">
                                                <!-- buat ngasih liat jawaban yang ada right -->
<!--                                                <input class="radioButton" type="radio"-->
<!--                                                th:field="${hasilTes.submittedPaketSoal.listSoal[__${iterationStatus.index}__].listJawaban[__${iterStat.index}__].idJawaban}"-->
<!--                                                       th:value="${jawaban.idJawaban}"/>-->

                                                <input class="radioButton" type="radio" th:id="${jawaban.idJawaban}" th:name="${soal.idSoal}" th:value="${jawaban.idJawaban}"/>

                                                <label th:for="${jawaban.idJawaban}" th:text="${jawaban.jawaban}"></label>
                                            </li>
                                        </ul>
                                </div>
                            </div>
                        </tr>
                    </form>
                </div>

                <nav aria-label="Page navigation example">
                    <div style="text-align: right">
                        <p id="showing"></p>
                    </div>
                    <ul class="pagination justify-content-end">
                        <li id="prev-page">
                            <a class="page-link" href="javascript:void(0)" aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                    </ul>
                </nav>

                <div class="text-center">
                    <button class="btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter2">Selesai</button>
                </div>

            </div>
            <!-- /.container-fluid -->

        </div>
        <!-- End of Main Content -->

        <!-- Footer -->
        <footer th:replace="fragments/fragment :: footer">
        </footer>
        <!-- End of Footer -->

    </div>
    <!-- End of Content Wrapper -->

</div>
<!-- End of Page Wrapper -->

<!-- Scroll to Top Button-->
<a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
</a>

<!-- Modal Konfirmasi Kembali-->
<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title details-title" id="exampleModalLongTitle">KONFIRMASI PEMBATALAN TES</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" th:text="'Anda yakin ingin meninggalkan halaman ini? Hasil tes belum tersimpan sampai anda menekan tombol Selesai.'">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Tidak</button>
                <form th:action="@{/}">
                    <button type="submit" class="btn btn-danger">Ya</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal Konfirmasi Selesai-->
<div class="modal fade" id="exampleModalCenter2" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title details-title" id="exampleModalLongTitle">KONFIRMASI PENGERJAAN TES</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" th:text="'Apakah anda yakin telah selesai mengerjakan tes? Hasil tes akan tersimpan dan tidak dapat diubah lagi.'">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Tidak</button>
                <form th:action="@{/calonpengajar/aturan-mata-pelajaran}">
                    <button type="submit" class="btn btn-danger">Ya</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Logout Modal-->
<div th:replace="fragments/fragment :: logout">
</div>

<script>
    // pagination
    var numberOfItems = $("#loop .card").length;
    var limitPerPage = 5;
    var pageini = $(".pagination li.active").index() + 2;

    $('#loop .card:gt(' + (limitPerPage - 1) + ')').hide();
    var totalPages = Math.ceil(numberOfItems / limitPerPage);
    document.getElementById("showing").innerHTML = "Halaman " + pageini + " dari " + totalPages;

    $(".pagination").append("<li class='page-item active'><a class='page-link' href='javascript:void(0)'>" + 1 + "</a></li>");

    for (var i = 2; i <= totalPages; i++) {
        $(".pagination").append("<li class='page-item'><a class='page-link' href='javascript:void(0)'>" + i + "</a></li>");
    }

    $(".pagination").append("<li id='next-page'><a class='page-link' href='javascript:void(0)' aria-label=Next><span aria-hidden=true>&raquo;</span></a></li>");

    $(".pagination li.page-item").on("click", function () {
        if ($(this).hasClass("active")){
            return false;
        }
        else {
            var currentPage = $(this).index();
            $(".pagination li").removeClass("active");
            $(this).addClass("active");
            $("#loop .card").hide();

            var grandTotal = limitPerPage * currentPage;
            var i;
            for (i = grandTotal - limitPerPage; i < grandTotal; i++) {
                $("#loop .card:eq(" + i + ")").show();
            }
            document.getElementById("showing").innerHTML = "Halaman " + currentPage + " dari " + totalPages;

        }
    });

    $("#next-page").on("click", function() {
        var currentPage = $(".pagination li.active").index();
        if (currentPage === totalPages) {
            return false;
        } else {
            currentPage++;
            $(".pagination li").removeClass("active");
            $("#loop .card").hide();

            var grandTotal = limitPerPage * currentPage;
            for (var i = grandTotal - limitPerPage; i < grandTotal; i++) {
                $("#loop .card:eq(" + i + ")").show();
            }

            $(".pagination li.page-item:eq(" + (currentPage - 1) + ")").addClass("active");
            document.getElementById("showing").innerHTML = "Halaman " + currentPage + " dari " + totalPages;
        }
    });

    $("#prev-page").on("click", function() {
        var currentPage = $(".pagination li.active").index();
        if (currentPage === 1) {
            return false;
        } else {
            currentPage--;
            $(".pagination li").removeClass("active");
            $("#loop .card").hide();

            var grandTotal = limitPerPage * currentPage;
            for (var i = grandTotal - limitPerPage; i < grandTotal; i++) {
                $("#loop .card:eq(" + i + ")").show();
            }
            $(".pagination li.page-item:eq(" + (currentPage - 1) + ")").addClass("active");
            document.getElementById("showing").innerHTML = "Halaman " + currentPage + " dari " + totalPages;
        }
    });

    //timer
    var sec = parseInt(getCookie("timer")) ||  3599;
    var element = document.getElementById("status");
    var timerFunction = setInterval(function(){
        setTimer()
    },1000);
    function setTimer(){
        if(sec > 0){
            setCookie("timer",sec,sec);
            element.innerHTML = "<h5>Sisa waktu: <b>"+ parseInt(sec/60) + "</b> : <b>"+ parseInt(sec%60) + "</b></h5>";
            sec --;
        }else{
            clearInterval(timerFunction);
            element.innerHTML = "<h5>Sisa waktu: <b>"+ parseInt(sec/60) + "</b> : <b>"+ parseInt(sec%60) + "</b></h5>";
            document.getElementById('tes').submit();
        }
    }
    function setCookie(name,value,sec){
        var d = new Date();
        d.setTime(d.getTime() + (sec*1000));
        document.cookie = name+"="+value+"; expires="+d.toUTCString()+"; path=/";
    }

    function getCookie(cname) {
        var name = cname + "=";
        var ca = document.cookie.split(';');
        for(var i = 0; i <ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0)==' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length,c.length);
            }
        }
        return false;
    }

    /**
 * Plugin developed to save html forms data to LocalStorage to restore them after browser crashes, tabs closings
 * and other disasters. 
 * 
 * https://github.com/simsalabim/sisyphus
 *
 * @author Alexander Kaupanin <kaupanin@gmail.com>
 * @license MIT - see https://github.com/simsalabim/sisyphus/blob/master/MIT-LICENSE
 */

( function( $ ) {

function getElementIdentifier(el) {
        return '[id=' + el.attr( "id" ) + '][name=' + el.attr( "name" ) + ']';
}

$.fn.sisyphus = function( options ) {
    var identifier = $.map( this, function( obj ) {
        return getElementIdentifier( $( obj ) );
    }).join();

    var sisyphus = Sisyphus.getInstance( identifier );
    sisyphus.protect( this, options );
    return sisyphus;
};

var browserStorage = {};

/**
 * Check if local storage or other browser storage is available
 *
 * @return Boolean
 */
browserStorage.isAvailable = function() {
    if ( typeof $.jStorage === "object" ) {
        return true;
    }
    try {
        return localStorage.getItem;
    } catch ( e ) {
        return false;
    }
};

/**
 * Set data to browser storage
 *
 * @param [String] key
 * @param [String] value
 *
 * @return Boolean
 */
browserStorage.set = function( key, value ) {
    if ( typeof $.jStorage === "object" ) {
        $.jStorage.set( key, value + "" );
    } else {
        try {
            localStorage.setItem( key, value + "" );
        } catch ( e ) {
            //QUOTA_EXCEEDED_ERR
        }
    }
};

/**
 * Get data from browser storage by specified key
 *
 * @param [String] key
 *
 * @return string
 */
browserStorage.get = function( key ) {
    if ( typeof $.jStorage === "object" ) {
        var result = $.jStorage.get( key );
        return result ? result.toString() : result;
    } else {
        return localStorage.getItem( key );
    }
};

/**
 * Delete data from browser storage by specified key
 *
 * @param [String] key
 *
 * @return void
 */
browserStorage.remove = function( key ) {
    if ( typeof $.jStorage === "object" ) {
        $.jStorage.deleteKey( key );
    } else {
        localStorage.removeItem( key );
    }
};

Sisyphus = ( function() {
    var params = {
        instantiated: [],
        started: []
    };
    var CKEDITOR = window.CKEDITOR;

    function init () {

        return {
            setInstanceIdentifier: function( identifier ) {
                this.identifier = identifier;
            },

            getInstanceIdentifier: function() {
                return this.identifier;
            },

            /**
             * Set plugin initial options
             *
             * @param [Object] options
             *
             * @return void
             */
            setInitialOptions: function ( options ) {
                var defaults = {
                    excludeFields: [],
                    customKeySuffix: "",
                    locationBased: false,
                    timeout: 0,
                    autoRelease: true,
                    onBeforeSave: function() {},
                    onSave: function() {},
                    onBeforeRestore: function() {},
                    onRestore: function() {},
                    onRelease: function() {}
                };
                this.options = this.options || $.extend( defaults, options );
                this.browserStorage = browserStorage;
            },

            /**
             * Set plugin options
             *
             * @param [Object] options
             *
             * @return void
             */
            setOptions: function ( options ) {
                this.options = this.options || this.setInitialOptions( options );
                this.options = $.extend( this.options, options );
            },

            /**
             * Protect specified forms, store it's fields data to local storage and restore them on page load
             *
             * @param [Object] targets		forms object(s), result of jQuery selector
             * @param Object options			plugin options
             *
             * @return void
             */
            protect: function( targets, options ) {
                this.setOptions( options );
                targets = targets || {};
                var self = this;
                this.targets = this.targets || [];
                if ( self.options.name ) {
                    this.href = self.options.name;
                } else {
                    this.href = location.hostname + location.pathname + location.search + location.hash;
                }
                this.targets = $.merge( this.targets, targets );
                this.targets = $.unique( this.targets );
                this.targets = $( this.targets );
                if ( ! this.browserStorage.isAvailable() ) {
                    return false;
                }

                var callback_result = self.options.onBeforeRestore.call( self );
                if ( callback_result === undefined || callback_result ) {
                    self.restoreAllData();
                }

                if ( this.options.autoRelease ) {
                    self.bindReleaseData();
                }

                if ( ! params.started[ this.getInstanceIdentifier() ] ) {
                    if ( self.isCKEditorPresent() ) {
                        var intervalId = setInterval( function() {
                            if (CKEDITOR.isLoaded) {
                                clearInterval(intervalId);
                                self.bindSaveData();
                                params.started[ self.getInstanceIdentifier() ] = true;
                            }
                        }, 100);
                    } else {
                        self.bindSaveData();
                        params.started[ self.getInstanceIdentifier() ] = true;
                    }
                }
            },

            isCKEditorPresent: function() {
                if ( this.isCKEditorExists() ) {
                    CKEDITOR.isLoaded = false;
                    CKEDITOR.on('instanceReady', function() {
                        CKEDITOR.isLoaded = true;
                    } );
                    return true;
                } else {
                    return false;
                }
            },

            isCKEditorExists: function() {
                return typeof CKEDITOR !== "undefined";
            },

            findFieldsToProtect: function( target ) {
                return target.find( ":input" ).not( ":submit" ).not( ":reset" ).not( ":button" ).not( ":file" ).not( ":password" ).not( ":disabled" ).not( "[readonly]" );
            },

            /**
             * Bind saving data
             *
             * @return void
             */
            bindSaveData: function() {
                var self = this;

                if ( self.options.timeout ) {
                    self.saveDataByTimeout();
                }

                self.targets.each( function() {
                    var targetFormIdAndName = getElementIdentifier( $( this ) );
                    self.findFieldsToProtect( $( this ) ).each( function() {
                        if ( $.inArray( this, self.options.excludeFields ) !== -1 ) {
                            // Returning non-false is the same as a continue statement in a for loop; it will skip immediately to the next iteration.
                            return true;
                        }
                        var field = $( this );
                        var prefix = (self.options.locationBased ? self.href : "") + targetFormIdAndName + getElementIdentifier( field ) + self.options.customKeySuffix;
                        if ( field.is( ":text" ) || field.is( "textarea" ) ) {
                            if ( ! self.options.timeout ) {
                                self.bindSaveDataImmediately( field, prefix );
                            }
                        }
                        self.bindSaveDataOnChange( field );
                    } );
                } );
            },

            /**
             * Save all protected forms data to Local Storage.
             * Common method, necessary to not lead astray user firing 'data is saved' when select/checkbox/radio
             * is changed and saved, while text field data is saved only by timeout
             *
             * @return void
             */
            saveAllData: function() {
                var self = this;
                self.targets.each( function() {
                    var targetFormIdAndName = getElementIdentifier( $( this ) );
                    var multiCheckboxCache = {};

                    self.findFieldsToProtect( $( this) ).each( function() {
                        var field = $( this );
                        if ( $.inArray( this, self.options.excludeFields ) !== -1 || ( field.attr( "name" ) === undefined && field.attr( "id" ) === undefined ) ) {
                            // Returning non-false is the same as a continue statement in a for loop; it will skip immediately to the next iteration.
                            return true;
                        }
                        var prefix = (self.options.locationBased ? self.href : "") + targetFormIdAndName + getElementIdentifier( field ) + self.options.customKeySuffix;
                        var value = field.val();

                        if ( field.is(":checkbox") ) {
                            var name = field.attr( "name" );
                            if ( name !== undefined && name.indexOf( "[" ) !== -1 ) {
                                if ( multiCheckboxCache[ name ] === true ) {
                                    return;
                                }
                                value = [];
                                $( "[name='" + name +"']:checked" ).each( function() {
                                    value.push( $( this ).val() );
                                } );
                                multiCheckboxCache[ name ] = true;
                            } else {
                                value = field.is( ":checked" );
                            }
                            self.saveToBrowserStorage( prefix, value, false );
                        } else if ( field.is( ":radio" ) ) {
                            if ( field.is( ":checked" ) ) {
                                value = field.val();
                                self.saveToBrowserStorage( prefix, value, false );
                            } else {
                                self.browserStorage.remove( prefix );
                            }
                        } else {
                            if ( self.isCKEditorExists() ) {
                                var editor = CKEDITOR.instances[ field.attr("name") ] || CKEDITOR.instances[ field.attr("id") ];
                                if ( editor ) {
                                    editor.updateElement();
                                    self.saveToBrowserStorage( prefix, field.val(), false);
                                } else {
                                    self.saveToBrowserStorage( prefix, value, false );
                                }
                            } else {
                                self.saveToBrowserStorage( prefix, value, false );
                            }
                        }
                    } );
                } );
                self.options.onSave.call( self );
            },

            /**
             * Restore forms data from Local Storage
             *
             * @return void
             */
            restoreAllData: function() {
                var self = this;
                var restored = false;

                self.targets.each( function() {
                    var target = $( this );
                    var targetFormIdAndName = getElementIdentifier( $( this ) );

                    self.findFieldsToProtect( target ).each( function() {
                        if ( $.inArray( this, self.options.excludeFields ) !== -1 ) {
                            // Returning non-false is the same as a continue statement in a for loop; it will skip immediately to the next iteration.
                            return true;
                        }
                        var field = $( this );
                        var prefix = (self.options.locationBased ? self.href : "") + targetFormIdAndName + getElementIdentifier( field ) + self.options.customKeySuffix;
                        var resque = self.browserStorage.get( prefix );
                        if ( resque !== null ) {
                            self.restoreFieldsData( field, resque );
                            restored = true;
                        }
                    } );
                } );

                if ( restored ) {
                    self.options.onRestore.call( self );
                }
            },

            /**
             * Restore form field data from local storage
             *
             * @param Object field		jQuery form element object
             * @param String resque	 previously stored fields data
             *
             * @return void
             */
            restoreFieldsData: function( field, resque ) {
                if ( field.attr( "name" ) === undefined && field.attr( "id" ) === undefined ) {
                    return false;
                }
                var name = field.attr( "name" );
                if ( field.is( ":checkbox" ) && resque !== "false" && ( name === undefined || name.indexOf( "[" ) === -1 ) ) {
                    // If we aren't named by name (e.g. id) or we aren't in a multiple element field
                    field.prop( "checked", true );
                } else if( field.is( ":checkbox" ) && resque === "false" && ( name === undefined || name.indexOf( "[" ) === -1 ) ) {
                    // If we aren't named by name (e.g. id) or we aren't in a multiple element field
                    field.prop( "checked", false );
                } else if ( field.is( ":radio" ) ) {
                    if ( field.val() === resque ) {
                        field.prop( "checked", true );
                    }
                } else if ( name === undefined || name.indexOf( "[" ) === -1 ) {
                    // If we aren't named by name (e.g. id) or we aren't in a multiple element field
                    field.val( resque );
                } else {
                    resque = resque.split( "," );
                    field.val( resque );
                }
            },

            /**
             * Bind immediate saving (on typing/checking/changing) field data to local storage when user fills it
             *
             * @param Object field		jQuery form element object
             * @param String prefix	 prefix used as key to store data in local storage
             *
             * @return void
             */
            bindSaveDataImmediately: function( field, prefix ) {
                var self = this;
                if ( 'onpropertychange' in field ) {
                    field.get(0).onpropertychange = function() {
                        self.saveToBrowserStorage( prefix, field.val() );
                    };
                } else {
                    field.get(0).oninput = function() {
                        self.saveToBrowserStorage( prefix, field.val() );
                    };
                }
                if ( this.isCKEditorExists() ) {
                    var editor = CKEDITOR.instances[ field.attr("name") ] || CKEDITOR.instances[ field.attr("id") ];
                    if ( editor ) {
                        editor.document.on( 'keyup', function() {
                            editor.updateElement();
                            self.saveToBrowserStorage( prefix, field.val() );
                        } );
                    }
                }
            },

            /**
             * Save data to Local Storage and fire callback if defined
             *
             * @param String key
             * @param String value
             * @param Boolean [true] fireCallback
             *
             * @return void
             */
            saveToBrowserStorage: function( key, value, fireCallback ) {
                var self = this;
                
                var callback_result = self.options.onBeforeSave.call( self );
                if ( callback_result !== undefined && callback_result === false ) {
                    return;
                }

                // if fireCallback is undefined it should be true
                fireCallback = fireCallback === undefined ? true : fireCallback;
                this.browserStorage.set( key, value );
                if ( fireCallback && value !== "" ) {
                    this.options.onSave.call( this );
                }
            },

            /**
             * Bind saving field data on change
             *
             * @param Object field		jQuery form element object
             *
             * @return void
             */
            bindSaveDataOnChange: function( field ) {
                var self = this;
                field.change( function() {
                    self.saveAllData();
                } );
            },

            /**
             * Saving (by timeout) field data to local storage when user fills it
             *
             * @return void
             */
            saveDataByTimeout: function() {
                var self = this;
                var targetForms = self.targets;
                setTimeout( ( function() {
                    function timeout() {
                        self.saveAllData();
                        setTimeout( timeout, self.options.timeout * 1000 );
                    }
                    return timeout;
                } )( targetForms ), self.options.timeout * 1000 );
            },

            /**
             * Bind release form fields data from local storage on submit/reset form
             *
             * @return void
             */
            bindReleaseData: function() {
                var self = this;
                self.targets.each( function() {
                    var target = $( this );
                    var formIdAndName = getElementIdentifier( target );
                    $( this ).bind( "submit reset", function() {
                        self.releaseData( formIdAndName, self.findFieldsToProtect( target ) );
                    } );
                } );
            },

            /**
             * Manually release form fields
             *
             * @return void
             */
            manuallyReleaseData: function() {
                var self = this;
                self.targets.each( function() {
                    var target = $( this );
                    var formIdAndName = getElementIdentifier( target );
                    self.releaseData( formIdAndName, self.findFieldsToProtect( target ) );
                } );
            },

            /**
             * Bind release form fields data from local storage on submit/resett form
             *
             * @param String targetFormIdAndName	a form identifier consists of its id and name glued
             * @param Object fieldsToProtect		jQuery object contains form fields to protect
             *
             * @return void
             */
            releaseData: function( targetFormIdAndName, fieldsToProtect ) {
                var released = false;
                var self = this;

                // Released form, are not started anymore. Fix for ajax loaded forms.
                params.started[ self.getInstanceIdentifier() ] = false;

                fieldsToProtect.each( function() {
                    if ( $.inArray( this, self.options.excludeFields ) !== -1 ) {
                        // Returning non-false is the same as a continue statement in a for loop; it will skip immediately to the next iteration.
                        return true;
                    }
                    var field = $( this );
                    var prefix = (self.options.locationBased ? self.href : "") + targetFormIdAndName + getElementIdentifier( field ) + self.options.customKeySuffix;
                    self.browserStorage.remove( prefix );
                    released = true;
                } );

                if ( released ) {
                    self.options.onRelease.call( self );
                }
            }

        };
    }

    return {
        getInstance: function( identifier ) {
            if ( ! params.instantiated[ identifier ] ) {
                params.instantiated[ identifier ] = init();
                params.instantiated[ identifier ].setInstanceIdentifier( identifier );
                params.instantiated[ identifier ].setInitialOptions();
            }
            if ( identifier ) {
                return params.instantiated[ identifier ];
            }
            return params.instantiated[ identifier ];
        },

        free: function() {
            params = {
                instantiated: [],
                started: []
            };
            return null;
        },
        version: '1.1.3'
    };
} )();
} )( jQuery );


function attachSisyphus(objSel)
{
	$(objSel).sisyphus({
		timeout: 0,
		autoRelease: false,
		locationBased: true,
		onBeforeRestore: function() {return false;},
		onBeforeSave: function() {return false;}
	});
}

function save_sisyphus(objSel) {
	var s = $(objSel).sisyphus();

	// Allow to save keeping old behaviour.
	var original_behaviour = s.options.onBeforeSave;
	s.options.onBeforeSave = function(){return true;}

	// Save and restore original behaviour
	s.saveAllData();
	s.options.onBeforeSave = original_behaviour;
	return true;
};

function restore_last_saved_values(objSel){
	c = confirm("You are about to restore your data.\nDo you want to continue?");
	if (!c) return false;

	$(objSel).sisyphus().restoreAllData();
	alert('Your data has been restored.');
	return true;
}
					$(document).ready(function(){
						attachSisyphus("#tes")
					});
			

    

</script>
</body>
</html>